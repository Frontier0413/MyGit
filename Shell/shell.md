# Shell脚本简介

## bash shell功能

1. Histroy历史命令，使用方向键可以显示历史使用过的命令

2. TAB建命令补全，按一下TAB表示补全命令，连按两下可以显示以当前字符开头的命令有哪些

3. type命令，使用type [-option] name可以显示name是bash内置命令还是外部命令
    > 不加参数时，仅显示name是外部命令还是内部命令
    > 此外还有-t、-p、-a等参数

4. 使用CTRL + u/k可以从当前光标开始向前/后删除命令，使用CTRL + a/e可以使光标移动到命令串的最前/后面

## shell变量

1. 使用echo可以使用一个变量，变量的前面必须加上$符号，使用echo $var或者echo ${var}可以在终端输出变量值,shell中变量是区分大小写的

2. 变量赋值时双引号中可以使用特殊转义符号，如var="hello $v"则var为hello 后面加上变量v，单引号内则$v直接显示为$v。
    > 注意=号左右两边不能加空格，否则会出现语法错误

3. 使用unset可以取消变量的设置，可以理解为从内存中释放，使用export命令可以将变量加入到环境变量中。

4. 使用反单引号包围的命令会优先执行，其执行结果返回作为外部命令的输入信息。反单引号为tab键上方的符号。

## 环境变量

1. 环境变量是shel中的一种特殊变量，可以使用env或export命令查看当前shell的环境变量。例如HOME变量存储的是用户的根目录，可以使用cd $HOME直接打开根目录
   PATH表示执行文件查找的路劲，目录与目录之前用:分隔。此外，如果要查看更多关于shell的变量信息，例如用户自己定义的变量，使用set命令。

2. $本身也是个变量，代表当前shell的进程号，此外？也是特殊变量，它记录了上一次命令执行的返回值。使用bash创建一个新的shell时，新的shell是当前shell的子进程，子进程会继承父进程的环境变量，但不会继承自定义变量，因此需要使用export命令将变量加入环境变量中，这样子进程就可以访问该变量了。

3. shell运行时，操作系统会分配一块内存给shell，此内存中的变量可以让子进程使用，export会将变量写入到该内存中，当加载另一个shell时，子shell可以将父shell的环境变量所在的内存导入到自己的环境变量区块中。

### 常见命令

1. read。read表示读取来自键盘输入，例如read var，则将用户的输入写入到var中。使用-p后可以接提示符，使用-t可以限制等待输入的秒数，如：read -p "please input:" -t 30 name,会显示提示字符"please input"，此外，若30s未输入完成，则自动退出。

2. declare，声明变量的类型，-a表示定义为数组，-i表示定义为整型，-x表示定义为环境变量，-r表示定义为只读类型。例如declare -ir testinteger；表示定义了只读的整型变量testinteger。若不指明类型，则默认为字符串类型。

3. alias命令别名，例如试听alias ld='ld -ln'，则每次输入ld时执行的命令为ld -ln。

4. history命令，显示执行过的命令，可选参数n，表示显示过去的n条命令，-c清除所有命令缓存。

5. 通配符，bash中的通配符与正则表达式相同，如？匹配任意一个字符.

6. 数据重定向，标准输入使用< <<，标准输出使用> >>，标准错误输出使用2> 2>>，例如ls -ld < file,将ls -ld的输出信息重定向到testfile中，<与<<的区别是，前者清空目标文件中的数据后输入，后者累加输入。

7. 命令连续执行或条件执行，使用；可以一次输入多条命令，按顺序进行，命令使用；隔开。或者使用条件执行，&&和||其执行类似于条件语句中的&&和||。此外bash还有管道命令。即|。管道命令可以接受前一命令的标准输出，且管道命令必须能处理该输出。

8. cut命令。使用cut命令可以将字符串分割开来，可选参数-d,-f,-c。-d后面接分隔符，表示使用该字符将字符串分隔开，-f表示将字符串分隔开后选取第几段数据，-c表示以字符的单位取出固定字符区间。例如PATH为/usr/local/bin，可以使用命令echo $PATH -d '/' -f 3命令将输出local。-c表明按字符单位处理，例如cut -c 12-则每一行只输出12个字符之后的字符，12-18则只输出12到18个字符，-12则输出前12个字符。

9. grep命令。grep命令分析一行信息，若有我们需要的信息，才将其拿出来。grep可以使用正则表达式。简单格式为grep [-options] '查找字符‘。可选参数-a：将二进制文件按文本文件方式查找，-c：计算找到查找字符的次数，-i：忽略大小写，：-v反向选择，即选择查找字符未出现的行。

10. sort与uniq.sort将结果进行排序可选参数-f:忽略大小写，-b:忽略前面的空格部分，-r：反向排序，-u：即uniq，相同数组只显示一行。uniq命令可单独使用

11. wc命令，wc命令可以显示文件中的行数，字数，字符数目，可选参数-l:显示行数，-w显示字数，-m显示字符数。如wc -l test.cpp

12. 双重重定向，目的是为了将数据定向到目标文件外，还能在屏幕上输出，使用格式tee [-a] file,其中-a表示以累加的方式输出。

13. 字符转换命令，tr [-ds] set1，-d表示删除信息中的set1字符，-s表示替换重复字符。col命令，用来将tab建替换为空格，使用方式col -x str1。join命令用来合并两个文件，-t参数表示用后接的字符替换空格为分隔符，且将两条数据连成一行，-i参数表示忽略大小写，-1参数后接n表示第一个栏位以n来分析，-2类似。例如命令 join -t ':' -1 4 testfile1 -2 5 testfile2. split命令，用来将一个大文件转为小文件，可选参数-b表示按大小划分，可以加单位b,k,m等，-l表示按行划分。例如split -l 10 testfile testfile将testfile按每10行划分为多个文件，分别存在在以testfile为前缀的文件中，split命令会自动创建小文件，testfilea,testfileb,testfilec等。

14. sed工具，sed本身是一个管道命令，可以分析标准输入，sed还可以将数据进行替换，删除，新增，选取特定行等功能。选项参数
    > -n，使用安静模式，一般的sed命令所有来自标准输入的数据都会列出，使用-n可以只输出sed特殊处理过的哪一行
    > -e，直接在命令行模式上进行sed的操作编辑
    > -f，直接将sed的操作写在一个文件内，-f filename则可以执行filename内的sed操作。
    > -r，sed的操作使用的是扩展型正则表达式的语法
    > -i，直接修改读取的文件内容，而不是由屏幕输出。
    > n1,n2表示进行操作的行数
    > a,表示新增，a后面可以接字符，而这些字符会在新的一行出现(下一行)
    > c，替换，c后面也可以接字符，这些字符可以替换n1,n2之间的行
    > d,删除
    > i，插入，后面可以接字符，这些字符会在新的一行出现(上一行)
    > p，打印，将某个选择的数据打印出来
    > s,替换，搭配正则表达式使用。
    例如nl testfile | sed '2,5d'将testfile中的2到5行删除，nl testfile | sed '2,$d'表示删除2到最后一行。其中，-e参数被省略了。
    nl testfile | sed '2a hello world'表示在第二行后面新起一行，且内容为hello world。可以一次新增多行，多行之间用\隔开。
    nl testfile |seq '2,5c hello world'则使用hello world替换2到5行。
    使用正则表达式替换时使用命令's/要被替换的字符/新的字符/g’。
    此外，可以使用sed '/^$/d'表示删除所有空白行。

15. awk命令。模式为awk '条件类型1{操作1} 条件类型2{操作2}' filename。
    awk命令主要用来将每一行的分成数个字段来处理，sed则是作用于一整个行的处理。例如last -n 5 | awk '{print $1 "\t" $3}'命令将last -n 5返回的数据按对应格式打印。awk命令含有内置变量，用于描述处理的数据:
    > NF，每一行拥有的字段总数
    > NR，目前awk处理的时第几行数据
    > FS，目前的分隔符，默认是空格
    其中每一个字段被赋予$1,$2...$n中，我们可以在操作中直接使用这些变量。条件类型可以使用内置的条件比较符如<,<=等。
    如命令awl '$1 < 10{print $2 $3}'如果第一个字符长度小于10，则打印第二第三个字段，中间以空格隔开。如需要更改默认分隔符，可以使用BEGIN，例如：
    awk 'BEGIN{FS=":"} $1 < 10{print $2 $3}'.另外与bash shell不同，除$1,$2。。。之外，其余变量无需加上$即可以直接使用。

16. 比较命令，diff与comp。diff比较两个文件，通常用于比较ASCII纯文本，使用格式为diff [-options] form-file to-file。可选参数为-b,忽略空白差异，  即  hello world与hello     world相同。-B,忽略空白行的差异。-i，忽略大小写差异。
    comp主要利用字节单位去比对，因此，可以用于二进制文件。可选参数-l，将所有不同点的字节都列出来，因为cmp默认输出第一个发现的不同点。 
    此外我们可以将diff得到的different信息保存到后缀为patch的文件里,如diff -b test1 test2 > testdiff.patch。我们还可以利用patch命令进行旧文件到新文件的更新。

## shell脚本

1. shell脚本以#作为注释符，任何在#后面的字符将作为注释，除了#！。#!开头的行被称为shebang行，当脚本被执行时，它能加载bash的相关环境配置文件，并且执行bash来使下面的命令能够执行。一般写欸#!/bin/bash。且此行应作为第一行。

2. test命令，test命令常用来判断文件，其返回一个状态值以便在后续的条件语句中判断test结果。如test -e filename判断filename是否存在，-f判断filename是否为文件，-d判断是否为目录，例如test -e filename || touch filename当filename存在时，后面的语句不会执行，当filename不存在时，创建filename。test还有其他很多用法，比如检测文件权限，整数与字符串判断等等。test命令可以使用中括号代替，例如上面的语句可以写成[ -e "filename" ]在中括号中，test可以省略，但中括号中每个组件之间必须用空格隔开。中括号内的变量，都使用双引号括起来，常熟使用单引号括起来。

3. shell的默认变量，与awk类似，shell的内置变量设置为$1,,$2...$n。其中脚本名字为$0,后面的参数依次赋给$2,$3...。此外，还有一些特殊的变量，$#表示后接的参数个数。$@表示每个参数拼接起来。$*类似，但是每个参数拼接时中间用空格隔开。

4. if...then。条件执行语句，其中的else && ||都与c语言中的相同，但if then语句结束时必须加上fi，代表if语句结束的之意。且if then语句支持elif。

5. case语句，case语句同样与c语言类似，且case语句在结束时也应该写明esac，即case倒过来。case语句的每一个变量程序段结束时，都必须使用；；来表示结束。

6. shell也可以定于函数，格式为function fname() { }。在函数中，也是用$0,$这个参数与shell脚本中的无关。

7. while do done, until do done。循环，其中done表示的是循环的结束位置，例如:
   while [ condition ]
   do
        程序段
   done #循环结束
   until与while语法相同，不同之处在于语义，while的语义为当condition为真是执行，until为当condition为真时停止执行。
   for do done。for一般用于已知进行几次循环。例如
   for var in con1 con2 con3
   do
        程序段
   done。在使用某个整型范围时，可以使用seq，例如 for i in $(seq 1 100)。
   此外for还支持类似c语言中的for循环，语法为
   for (( ; ; ))
   do
        程序段
   done
